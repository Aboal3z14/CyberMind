document.addEventListener("DOMContentLoaded", () => {
  const choices = document.querySelectorAll("#level4-screen .usb-choice");
  const feedback = document.getElementById("level4-feedback");
  const progress = document.getElementById("level4-progress");
  const scoreEl = document.getElementById("level4-score");
  const cyberBuddy = document.getElementById("cyberbuddy");

  let score = 0;
  let attempts = 0;

  choices.forEach(choice => {
    choice.addEventListener("click", () => {
      const isCorrect = choice.dataset.correct === "true";
      attempts++;
      if (isCorrect) {
        score++;
        feedback.textContent = "✅ أحسنت! دي أفضل طريقة للتعامل مع الفلاشات المشبوهة.";
        feedback.style.color = "lime";
        if (cyberBuddy) {
          cyberBuddy.innerHTML = "🤖 <strong>سايبر بودي</strong><br> شاطر! الفلاشات المجهولة غالبًا بيكون فيها فيروسات أو سباي وير.";
        }
      } else {
        feedback.textContent = "❌ دي حركة خطيرة! ممكن الفلاشة تبقى مصيدة.";
        feedback.style.color = "red";
        getCyberBuddyResponse("اللاعب اختار يفتح فلاشة مجهولة. اديله نصيحة باللهجة المصرية")
          .then(response => {
            if (cyberBuddy) cyberBuddy.innerHTML = `🤖 <strong>سايبر بودي</strong><br>${response}`;
          });
      }

      scoreEl.textContent = attempts;
      progress.style.width = `${(score / attempts) * 100}%`;
    });
  });
});
