document.addEventListener("DOMContentLoaded", () => {
  const choices = document.querySelectorAll("#level4-screen .usb-choice");
  const feedback = document.getElementById("level4-feedback");
  const progress = document.getElementById("level4-progress");
  const scoreEl = document.getElementById("level4-score");
  const cyberBuddy = document.getElementById("cyberbuddy");

  let score = 0;
  let attempts = 0;

  choices.forEach(choice => {
    choice.addEventListener("click", () => {
      const isCorrect = choice.dataset.correct === "true";
      attempts++;
      if (isCorrect) {
        score++;
        feedback.textContent = "âœ… Ø£Ø­Ø³Ù†Øª! Ø¯ÙŠ Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙÙ„Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©.";
        feedback.style.color = "lime";
        if (cyberBuddy) {
          cyberBuddy.innerHTML = "ğŸ¤– <strong>Ø³Ø§ÙŠØ¨Ø± Ø¨ÙˆØ¯ÙŠ</strong><br> Ø´Ø§Ø·Ø±! Ø§Ù„ÙÙ„Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„Ø© ØºØ§Ù„Ø¨Ù‹Ø§ Ø¨ÙŠÙƒÙˆÙ† ÙÙŠÙ‡Ø§ ÙÙŠØ±ÙˆØ³Ø§Øª Ø£Ùˆ Ø³Ø¨Ø§ÙŠ ÙˆÙŠØ±.";
        }
      } else {
        feedback.textContent = "âŒ Ø¯ÙŠ Ø­Ø±ÙƒØ© Ø®Ø·ÙŠØ±Ø©! Ù…Ù…ÙƒÙ† Ø§Ù„ÙÙ„Ø§Ø´Ø© ØªØ¨Ù‚Ù‰ Ù…ØµÙŠØ¯Ø©.";
        feedback.style.color = "red";
        getCyberBuddyResponse("Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ø®ØªØ§Ø± ÙŠÙØªØ­ ÙÙ„Ø§Ø´Ø© Ù…Ø¬Ù‡ÙˆÙ„Ø©. Ø§Ø¯ÙŠÙ„Ù‡ Ù†ØµÙŠØ­Ø© Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©")
          .then(response => {
            if (cyberBuddy) cyberBuddy.innerHTML = `ğŸ¤– <strong>Ø³Ø§ÙŠØ¨Ø± Ø¨ÙˆØ¯ÙŠ</strong><br>${response}`;
          });
      }

      scoreEl.textContent = attempts;
      progress.style.width = `${(score / attempts) * 100}%`;
    });
  });
});
